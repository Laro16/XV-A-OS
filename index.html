<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Invitación XV — Plantilla Responsive</title>
  <meta name="description" content="Invitación elegante optimizada para celular con cuenta regresiva, galería, mapa, RSVP por WhatsApp y audio.">
  <meta name="theme-color" content="#c6a664" />
  <link rel="canonical" href="https://invitacionnoviembre.vercel.app/">

  <!-- Open Graph / Twitter -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="¡Te invito a mis XV!" />
  <meta property="og:description" content="Cuenta regresiva, galería, mapa y confirmación por WhatsApp." />
  <meta property="og:image" content="./assets/img/portada.jpg" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- Tipografías -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;600&family=Great+Vibes&display=swap" rel="stylesheet">
  <!-- Íconos -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

  <style>
    :root{
      --primary:#c6a664;
      --primary-2:#a9904f;
      --text:#1a1a1a;
      --muted:#6b6b6b;
      --card:#ffffffEE;
      --bg-color:#f6edf1;
      --shadow: 0 8px 24px rgba(0,0,0,.12);
      --radius: 20px;

      --texture: radial-gradient(60vw 60vw at -10% -10%, #fdf6f9 0 30%, transparent 32%),
                 radial-gradient(50vw 50vw at 120% -20%, #f7e7ee 0 35%, transparent 37%),
                 radial-gradient(40vw 40vw at 50% 120%, #f3dbe6 0 28%, transparent 30%);

      --bg-image: url("./assets/img/portada.jpg");
      --bg-blend: soft-light;
      --hero-image: url("./assets/img/portada.jpg");

      /* Accesibilidad de contraste para botones */
      --btn-text:#111111; /* texto oscuro sobre dorado */
      --chip-bg: #ffffffcc;
      --chip-text: #1a1a1a;
    }

    @media (prefers-color-scheme: dark){
      :root{
        --text:#f5f5f5;
        --muted:#c2c2c2;
        --card:#121214cc;
        --bg-color:#0f0f10;
        --chip-bg:#1f1f1fcc;
        --chip-text:#f5f5f5;
      }
      body{ background-blend-mode: multiply, var(--bg-blend); }
    }

    *{box-sizing:border-box}
    html{ scroll-behavior:smooth }
    html,body{height:100%}
    body{
      margin:0; color:var(--text); font-family:'Poppins',system-ui,Segoe UI,Roboto,Arial;
      line-height:1.6;
      background:
        var(--texture),
        var(--bg-image);
      background-color: var(--bg-color);
      background-repeat:no-repeat, no-repeat;
      background-size: cover, cover;
      background-position:center top, center top;
      background-blend-mode: normal, var(--bg-blend);
      background-attachment: scroll;
      overflow-x:hidden;
    }

    .wrap{ width:100%; max-width:720px; margin-inline:auto; padding-inline:16px; }
    .card{ background:var(--card); backdrop-filter: blur(6px); border-radius:var(--radius); box-shadow:0 6px 18px rgba(0,0,0,.12); }

    /* HERO (usa dvh para barras del navegador móviles) */
    .hero{
      position:relative; overflow:hidden; border-radius:0 0 32px 32px;
      min-height: min(70dvh, 640px);
      display:flex; align-items:flex-end;
      background-image: var(--hero-image);
      background-size: cover; background-position: center;
      padding-bottom: 22px;
    }
    .hero::after{ /* degradado para legibilidad del contador */
      content:""; position:absolute; inset:auto 0 0 0; height:40%;
      background: linear-gradient(to top, rgba(0,0,0,.45), transparent);
      pointer-events:none;
    }
    .hero .portrait{
      position:absolute; inset:0; width:100%; height:100%; object-fit:cover;
      filter: contrast(1.05) saturate(1.05);
    }

    /* Monograma */
    .monogram{
      position:relative; z-index:2;
      width: min(42vw, 160px);
      aspect-ratio: 1 / 1;
      margin:0 auto -18px;
      border-radius:50%; display:grid; place-items:center; color:#fff; text-align:center;
      background: radial-gradient(100px 100px at center,
                  rgba(198,166,100,.90), rgba(169,144,79,.90));
      box-shadow:0 10px 26px rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.35);
    }
    .monogram .small{font:600 14px/1 'Poppins',sans-serif; letter-spacing:.2em}
    .monogram .big{font:400 44px/1 'Great Vibes', cursive}

    /* Contador */
    .countdown{ position:relative; z-index:2; display:flex; justify-content:space-between; gap:10px; padding:14px 12px 20px; color:#fff; font-weight:600; }
    .countdown .item{ flex:1; text-align:center; background:rgba(0,0,0,.42); border-radius:14px; padding:10px 6px; backdrop-filter: blur(4px); }
    .countdown .num{ font-size: clamp(20px, 6vw, 28px); display:block; }
    .countdown .lbl{ font-size:12px; opacity:.9; letter-spacing:.03em }

    /* Subnav pegajosa (chips) */
    .subnav{ position:sticky; top:0; z-index:30; backdrop-filter: blur(10px); padding:10px 4px; margin-top:6px; }
    .subnav .inner{ display:flex; gap:10px; overflow:auto; padding-bottom:6px; }
    .chip{ flex:0 0 auto; padding:10px 12px; border-radius:999px; background:var(--chip-bg); color:var(--chip-text); border:1px solid #00000014; text-decoration:none; font-weight:600; }

    section{ padding:28px 0; scroll-margin-top:76px; }
    h2{ font-family:'Playfair Display', serif; font-weight:700; font-size: clamp(22px, 5vw, 28px); margin:0 0 8px; text-align:center; }
    .subtitle{ text-align:center; color:var(--muted); margin-bottom:18px; }
    .intro{ text-align:center; padding:20px; }
    .script{ font-family:'Great Vibes', cursive; font-size: clamp(30px, 7vw, 36px); color:var(--primary-2); }

    .grid{ display:grid; gap:18px; }
    .place img{ width:100%; aspect-ratio: 4/3; object-fit:cover; border-radius:14px; }
    .place h3{ margin:12px 0 6px; font-family:'Playfair Display',serif; }
    .meta{ color:var(--muted); font-size:14px; }
    .btns{ display:flex; gap:10px; margin-top:12px; flex-wrap:wrap; }

    .btn{
      appearance:none; border:0; cursor:pointer; padding:12px 16px;
      border-radius:14px; background:var(--primary); color:var(--btn-text);
      font-weight:600; box-shadow:var(--shadow); text-decoration:none;
      display:inline-flex; align-items:center; gap:8px; transition: transform .08s ease;
    }
    .btn:active{ transform: translateY(1px) }
    .btn.ghost{ background:transparent; color:#111111; border:2px solid var(--primary) }

    .carousel{ position:relative; }
    .track{ display:flex; overflow:auto; scroll-snap-type:x mandatory; gap:10px; padding-bottom:8px; }
    .track img{ width:100%; flex:0 0 100%; scroll-snap-align:center; border-radius:18px; aspect-ratio: 3/4; object-fit:cover; }
    .nav{ position:absolute; inset:0; display:flex; justify-content:space-between; align-items:center; pointer-events:none; }
    .nav button{ pointer-events:auto; border:none; background:rgba(0,0,0,.5); color:#fff; width:48px; height:48px; border-radius:50%; display:grid; place-items:center; }
    .dots{ display:flex; gap:6px; justify-content:center; margin-top:10px; }
    .dot{ width:8px; height:8px; border-radius:50%; background:#00000040; }
    .dot[aria-current="true"]{ background:#00000090 }

    .rsvp small{ color:var(--muted); }
    .field{ display:flex; gap:8px; margin:10px 0; }
    .field input, .field select{ flex:1; padding:12px 12px; border-radius:12px; border:1.5px solid #ddd; background:#fff; font:inherit; }

    .music{ position:fixed; right:14px; bottom: calc(72px + env(safe-area-inset-bottom)); z-index:50; }

    /* Barra de acciones inferior */
    .actionbar{ position:fixed; left:0; right:0; bottom:0; z-index:40; padding:10px 16px calc(10px + env(safe-area-inset-bottom)); backdrop-filter: blur(10px); background:linear-gradient(to top, #ffffffdd, #ffffff99); border-top:1px solid #00000014; }
    .actionbar .row{ max-width:720px; margin:0 auto; display:flex; gap:10px; }
    .actionbar .row .btn{ flex:1 }
    @media (prefers-color-scheme: dark){
      .actionbar{ background:linear-gradient(to top, #050505dd, #05050599); border-top-color:#ffffff1a }
    }

    .aos{ opacity:0; transform: translateY(16px); transition: opacity .7s ease, transform .7s ease; }
    .aos.show{ opacity:1; transform:none }

    .divider{ height:1px; background:linear-gradient(to right, transparent, #00000020 15%, #00000020 85%, transparent); margin:8px 0 16px; }

    /* Accesibilidad: focus visible */
    :focus-visible{ outline:3px solid var(--primary); outline-offset:2px }

    @media(min-width:700px){
      .grid{ grid-template-columns: 1fr 1fr; }
      .monogram{ width:200px; }
    }

    /* Respeta preferencias del usuario */
    @media (prefers-reduced-motion: reduce){
      .aos{ transition:none }
    }
  </style>
</head>
<body>
  <!-- AUDIO -->
  <audio id="bgMusic" src="./assets/audio/musica.mp3" loop preload="none"></audio>
  <audio id="voiceNote" src="./assets/audio/mensaje.mp3" preload="none"></audio>

  <!-- data-event-datetime: hora local de Guatemala con offset -06:00 -->
  <main class="wrap" id="app" data-event-datetime="2025-11-30T20:00-06:00">
    <!-- HERO -->
    <header class="hero">
      <img class="portrait" src="./assets/img/portada.jpg" alt="Retrato de la quinceañera" loading="eager" fetchpriority="high" decoding="async" onerror="this.style.display='none'"/>
      <div class="monogram" aria-label="Monograma">
        <div>
          <div class="small">XV</div>
          <div class="big">BD</div>
        </div>
      </div>
      <div class="countdown" id="countdown" aria-live="polite">
        <div class="item"><span class="num" id="d">--</span><span class="lbl">Días</span></div>
        <div class="item"><span class="num" id="h">--</span><span class="lbl">Horas</span></div>
        <div class="item"><span class="num" id="m">--</span><span class="lbl">Minutos</span></div>
        <div class="item"><span class="num" id="s">--</span><span class="lbl">Segundos</span></div>
      </div>
      <button id="shareBtn" class="btn" style="position:absolute; top:12px; right:12px; backdrop-filter:blur(6px);">
        <i class="bi bi-share"></i> Compartir
      </button>
    </header>

    <!-- SUBNAV CHIPS -->
    <nav class="subnav" aria-label="Secciones">
      <div class="inner wrap">
        <a class="chip" href="#intro">Invitación</a>
        <a class="chip" href="#donde">Dónde & Cuándo</a>
        <a class="chip" href="#galeria">Galería</a>
        <a class="chip" href="#rsvp">Confirmar</a>
      </div>
    </nav>

    <!-- INTRO -->
    <section id="intro" class="card intro aos">
      <h2>¡Te invito a mis XV!</h2>
      <p>Hay momentos en la vida que siempre vamos a recordar. Me encantará compartir este día contigo.</p>
      <p class="script">Ariadne Reyes</p>
      <div class="btns" style="justify-content:center; margin-top:10px;">
        <button class="btn ghost" id="btnVoice" aria-pressed="false"><i class="bi bi-mic-fill"></i> Escuchar invitación</button>
      </div>
    </section>

    <!-- DÓNDE & CUÁNDO -->
    <section id="donde" class="aos">
      <h2>Dónde &amp; Cuándo</h2>
      <p class="subtitle">Acompáñame en la ceremonia y la recepción.</p>
      <div class="grid">
        <!-- CEREMONIA -->
        <article class="card place">
          <img src="./assets/img/Ceremonia.png" alt="Foto del lugar de la ceremonia" loading="lazy" decoding="async" fetchpriority="low">
          <div style="padding:12px 14px 16px;">
            <h3>Iglesia Retalhuleu</h3>
            <div class="meta">Sábado 30 de Noviembre, 6:00 pm</div>
            <div class="divider"></div>
            <div class="meta"><strong>Dirección:</strong> Parque central de Retalhuleu</div>
            <div class="btns">
              <a class="btn ghost" target="_blank" rel="noopener noreferrer" href="https://maps.app.goo.gl/Eoam4KMmS7f39aFc7"><i class="bi bi-geo-alt-fill"></i> Ver mapa</a>
              <!-- Cada botón ahora lleva su propio inicio (start) y duración -->
              <button class="btn addcal" data-title="Misa de XV" data-location="Parque central de Retalhuleu" data-start="2025-11-30T18:00-06:00" data-duration="PT60M"><i class="bi bi-calendar-plus"></i> Agendar</button>
              <button class="btn copy" data-copy="Parque central de Retalhuleu"><i class="bi bi-clipboard"></i> Copiar dirección</button>
            </div>
          </div>
        </article>
        <!-- RECEPCIÓN -->
        <article class="card place">
          <img src="./assets/img/recepcion.png" alt="Foto del salón de la recepción" loading="lazy" decoding="async" fetchpriority="low">
          <div style="padding:12px 14px 16px;">
            <h3>Salón de eventos Las Morenas</h3>
            <div class="meta">Sábado 30 de Noviembre, 8:00 pm</div>
            <div class="divider"></div>
            <div class="meta"><strong>Dirección:</strong> Salón de eventos Las Morenas</div>
            <div class="btns">
              <a class="btn ghost" target="_blank" rel="noopener noreferrer" href="https://maps.app.goo.gl/B3KwMzobw1izasHU7"><i class="bi bi-geo-alt-fill"></i> Ver mapa</a>
              <button class="btn addcal" data-title="Recepción XV" data-location="Salón de eventos Las Morenas" data-start="2025-11-30T20:00-06:00" data-duration="PT240M"><i class="bi bi-calendar-plus"></i> Agendar</button>
              <button class="btn copy" data-copy="Salón de eventos Las Morenas"><i class="bi bi-clipboard"></i> Copiar dirección</button>
            </div>
          </div>
        </article>
      </div>
    </section>

    <!-- GALERÍA -->
    <section id="galeria" class="aos">
      <h2>Mis Fotos</h2>
      <p class="subtitle">Desliza para ver la galería</p>
      <div class="card carousel">
        <div class="track" id="track" tabindex="0" aria-label="Carrusel de fotos" aria-roledescription="carrusel">
          <img src="./assets/img/portada.jpg" alt="Foto 1 de la quinceañera">
          <img src="./assets/img/foto1.jpg"  alt="Foto 2 de la quinceañera">
          <img src="./assets/img/foto2.jpg"  alt="Foto 3 de la quinceañera">
          <img src="./assets/img/recepcion.png" alt="Foto 4, salón de la recepción">
        </div>
        <div class="nav" aria-hidden="true">
          <button id="prev" aria-label="Anterior"><i class="bi bi-chevron-left"></i></button>
          <button id="next" aria-label="Siguiente"><i class="bi bi-chevron-right"></i></button>
        </div>
        <div class="dots" id="dots" aria-label="Indicadores de página"></div>
      </div>
    </section>

    <!-- RSVP -->
    <section id="rsvp" class="aos card rsvp" style="padding:16px 16px 18px;">
      <h2>Confirmar asistencia</h2>
      <p class="subtitle">Por favor confirma tu asistencia un mes antes del evento. ¡Gracias!</p>

      <!-- Recomendado: número en formato internacional sin +. Guatemala = 502 -->
      <form id="rsvpForm" data-whatsapp="50254389207">
        <div class="field"><input required type="text" name="nombre" placeholder="Tu nombre completo" autocomplete="name"></div>
        <div class="field">
          <select name="acompanantes" aria-label="Acompañantes">
            <option value="0">Asistiré sin acompañantes</option>
            <option value="1">+1 acompañante</option>
            <option value="2">+2 acompañantes</option>
            <option value="3">+3 acompañantes</option>
          </select>
        </div>
        <div class="btns">
          <button type="submit" class="btn" id="btnWA"><i class="bi bi-whatsapp"></i> Confirmar por WhatsApp</button>
          <a class="btn ghost" id="btnWAQuick" href="https://wa.me/50254389207?text=Hola%2C%20confirmo%20asistencia%20a%20los%20XV." target="_blank" rel="noopener noreferrer"><i class="bi bi-send"></i> Mensaje rápido</a>
        </div>
        <small>También puedes llamar a
          <a href="tel:+50254389207">+502 5438 9207</a>.
        </small>
      </form>
    </section>

    <section class="aos" style="text-align:center; color:var(--muted); padding-bottom:96px;">
      <p>Con cariño,</p>
      <p class="script" style="margin-top:-6px">Ariadne Reyes</p>
    </section>
  </main>

  <!-- Barra de acciones inferior -->
  <div class="actionbar" role="region" aria-label="Acciones rápidas">
    <div class="row">
      <a class="btn" href="#rsvp"><i class="bi bi-whatsapp"></i> Confirmar</a>
      <a class="btn ghost" href="#donde"><i class="bi bi-geo-alt"></i> Ver mapa</a>
    </div>
  </div>

  <!-- Botón flotante música -->
  <div class="music">
    <button class="btn" id="musicToggle" aria-pressed="false" aria-label="Reproducir música">
      <i class="bi bi-music-note-beamed"></i><span style="margin-left:6px">Música</span>
    </button>
  </div>

  <!-- Datos estructurados para mejor previsualización/SEO -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"Event",
    "name":"XV de Ariadne Reyes",
    "startDate":"2025-11-30T20:00:00-06:00",
    "eventAttendanceMode":"https://schema.org/OfflineEventAttendanceMode",
    "eventStatus":"https://schema.org/EventScheduled",
    "image":["./assets/img/portada.jpg"],
    "description":"Celebración de XV años con ceremonia y recepción.",
    "subEvent":[
      {
        "@type":"Event",
        "name":"Misa de XV",
        "startDate":"2025-11-30T18:00:00-06:00",
        "location":{"@type":"Place","name":"Iglesia Retalhuleu","address":"Parque central de Retalhuleu"}
      },
      {
        "@type":"Event",
        "name":"Recepción XV",
        "startDate":"2025-11-30T20:00:00-06:00",
        "location":{"@type":"Place","name":"Salón de eventos Las Morenas","address":"Salón de eventos Las Morenas"}
      }
    ]
  }
  </script>

  <script>
    const $  = (s, el=document)=> el.querySelector(s);
    const $$ = (s, el=document)=> [...el.querySelectorAll(s)];

    // Autoplay opcional al primer toque/click (respeta prefers-reduced-motion)
    document.addEventListener('DOMContentLoaded', () => {
      const startMusic = () => {
        if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
        document.getElementById('musicToggle')?.click();
        document.removeEventListener('click', startMusic);
        document.removeEventListener('touchstart', startMusic);
      };
      document.addEventListener('click', startMusic, {once:true});
      document.addEventListener('touchstart', startMusic, {once:true});
    });

    // Animaciones on-scroll
    const io = new IntersectionObserver(ents=>{
      ents.forEach(e=>{ if(e.isIntersecting) e.target.classList.add('show'); });
    }, {threshold:.15});
    $$('.aos').forEach(el=> io.observe(el));

    // Countdown (usa fecha del data-attribute con offset -06:00)
    (function(){
      const root = $('#app');
      const dtStr = root.getAttribute('data-event-datetime');
      if(!dtStr) return;
      const eventDate = new Date(dtStr);
      const pad = n=> String(n).padStart(2,'0');
      function tick(){
        const now = new Date();
        let diff = eventDate - now;
        if (diff < 0) diff = 0;
        const d = Math.floor(diff / (1000*60*60*24));
        const h = Math.floor((diff / (1000*60*60)) % 24);
        const m = Math.floor((diff / (1000*60)) % 60);
        const s = Math.floor((diff / 1000) % 60);
        $('#d').textContent = pad(d);
        $('#h').textContent = pad(h);
        $('#m').textContent = pad(m);
        $('#s').textContent = pad(s);
      }
      tick(); setInterval(tick,1000);
    })();

    // Carrusel + teclado + dots
    (function(){
      const track = $('#track');
      const dots  = $('#dots');
      const slides = $$('#track img');

      // Crear dots
      slides.forEach((_,i)=>{
        const b=document.createElement('button');
        b.className='dot'; b.type='button'; b.setAttribute('aria-label',`Ir a foto ${i+1}`);
        b.addEventListener('click',()=> track.scrollTo({left:i*track.clientWidth, behavior:'smooth'}));
        dots.appendChild(b);
      });

      const by = ()=> track.clientWidth;
      const setDot = ()=>{
        const idx = Math.round(track.scrollLeft / by());
        [...dots.children].forEach((d,i)=> d.setAttribute('aria-current', i===idx ? 'true':'false'));
      };
      setDot();

      $('#prev')?.addEventListener('click', ()=> track.scrollBy({left:-by(), behavior:'smooth'}));
      $('#next')?.addEventListener('click', ()=> track.scrollBy({left: by(), behavior:'smooth'}));
      track?.addEventListener('keydown', (e)=>{
        if(e.key==='ArrowLeft') track.scrollBy({left:-by(), behavior:'smooth'});
        if(e.key==='ArrowRight') track.scrollBy({left: by(), behavior:'smooth'});
      });
      track?.addEventListener('scroll', ()=> requestAnimationFrame(setDot));
      window.addEventListener('resize', setDot);
    })();

    // Música (toggle); pausa si se reproduce el mensaje de voz
    (function(){
      const bgMusic = $('#bgMusic');
      const musicBtn = $('#musicToggle');
      let musicPlaying = false;

      async function toggleMusic(){
        if(!bgMusic.src){ alert('Agrega una pista en ./assets/audio/musica.mp3'); return; }
        try{
          if(musicPlaying){
            bgMusic.pause(); musicPlaying=false;
            musicBtn.setAttribute('aria-pressed','false');
            musicBtn.innerHTML='<i class="bi bi-music-note-beamed"></i><span style="margin-left:6px">Música</span>';
          }else{
            await bgMusic.play(); musicPlaying=true;
            musicBtn.setAttribute('aria-pressed','true');
            musicBtn.innerHTML='<i class="bi bi-pause-fill"></i><span style="margin-left:6px">Pausar</span>';
          }
        }catch(e){}
      }
      musicBtn.addEventListener('click', toggleMusic);

      // Pausar música al reproducir nota de voz
      const voiceNote = $('#voiceNote');
      voiceNote.addEventListener('play', ()=>{ if(musicPlaying){ bgMusic.pause(); musicPlaying=false; musicBtn.setAttribute('aria-pressed','false'); musicBtn.innerHTML='<i class="bi bi-music-note-beamed"></i><span style="margin-left:6px">Música</span>'; }});
    })();

    // Mensaje de voz accesible
    (function(){
      const voiceBtn  = $('#btnVoice');
      const voiceNote = $('#voiceNote');
      let voicePlaying=false;
      voiceBtn.addEventListener('click', ()=>{
        if(!voiceNote.src){ alert('Agrega un audio en ./assets/audio/mensaje.mp3'); return; }
        if(voicePlaying){ voiceNote.pause(); voiceNote.currentTime=0; voicePlaying=false; voiceBtn.setAttribute('aria-pressed','false'); voiceBtn.innerHTML='<i class="bi bi-mic-fill"></i> Escuchar invitación'; }
        else { voiceNote.play(); voicePlaying=true; voiceBtn.setAttribute('aria-pressed','true'); voiceBtn.innerHTML='<i class="bi bi-stop-fill"></i> Detener audio'; }
      });
      voiceNote.addEventListener('ended', ()=>{ voicePlaying=false; voiceBtn.setAttribute('aria-pressed','false'); voiceBtn.innerHTML='<i class="bi bi-mic-fill"></i> Escuchar invitación'; });
    })();

    // Botón compartir (Web Share API)
    (function(){
      const share = $('#shareBtn');
      share?.addEventListener('click', async ()=>{
        const title = document.title || 'Invitación';
        const text  = '¡Te invito a mis XV!';
        const url   = window.location.href;
        if(navigator.share){
          try{ await navigator.share({title, text, url}); }catch(e){}
        }else{
          await navigator.clipboard.writeText(url);
          share.innerHTML = '<i class="bi bi-check2"></i> Enlace copiado';
          setTimeout(()=> share.innerHTML = '<i class="bi bi-share"></i> Compartir', 1800);
        }
      });
    })();

    // Copiar dirección
    (function(){
      $$('.copy').forEach(btn=> btn.addEventListener('click', async ()=>{
        const txt = btn.dataset.copy || '';
        try{
          await navigator.clipboard.writeText(txt);
          btn.innerHTML = '<i class="bi bi-check2"></i> Copiado';
          setTimeout(()=> btn.innerHTML = '<i class="bi bi-clipboard"></i> Copiar dirección', 1600);
        }catch(e){ alert('No se pudo copiar'); }
      }));
    })();

    // RSVP WhatsApp (localización es-GT)
    (function(){
      const rsvp = $('#rsvpForm');
      rsvp?.addEventListener('submit', (e)=>{
        e.preventDefault();

        const phone = rsvp.getAttribute('data-whatsapp')?.trim();
        if(!/^\d{8,15}$/.test(phone||'')){
          alert('Número de WhatsApp inválido. Usa formato internacional sin + ni espacios si es necesario.');
          return;
        }

        const nombre = rsvp.nombre.value.trim();
        if(!nombre){ alert('Por favor escribe tu nombre.'); return; }

        const acomp  = rsvp.acompanantes.value;
        const dtStr  = $('#app').getAttribute('data-event-datetime');
        const fecha  = new Date(dtStr).toLocaleString('es-GT',{ dateStyle:'full', timeStyle:'short' });
        const msg    = `Hola, soy ${nombre}. Confirmo asistencia a los XV el ${fecha}. Acompañantes: ${acomp}.`;
        const url    = `https://wa.me/${phone}?text=${encodeURIComponent(msg)}`;
        window.open(url, '_blank', 'noopener');
      });
    })();

    // Agregar a calendario (.ics) por evento
    (function(){
      function addMinutes(date, m){ const d=new Date(date); d.setMinutes(d.getMinutes()+m); return d; }
      function formatICS(dt){ const p=n=>String(n).padStart(2,'0'); return `${dt.getUTCFullYear()}${p(dt.getUTCMonth()+1)}${p(dt.getUTCDate())}T${p(dt.getUTCHours())}${p(dt.getUTCMinutes())}${p(dt.getUTCSeconds())}Z`; }
      function downloadICS({title, description, location, start, durationMinutes=120}){
        const st=new Date(start); const en=addMinutes(st,durationMinutes);
        const ics=`BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Creative Studio//Invitacion//ES\nBEGIN:VEVENT\nUID:${Date.now()}@creativestudio\nDTSTAMP:${formatICS(new Date())}\nDTSTART:${formatICS(st)}\nDTEND:${formatICS(en)}\nSUMMARY:${title}\nDESCRIPTION:${description}\nLOCATION:${location}\nEND:VEVENT\nEND:VCALENDAR`;
        const blob=new Blob([ics],{type:'text/calendar'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=`${title.replace(/\s+/g,'_')}.ics`; a.click(); URL.revokeObjectURL(a.href);
      }
      $$('.addcal').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const title=btn.dataset.title||'Evento';
          const place=btn.dataset.location||'';
          const mins = Number(/PT(\d+)M/.exec(btn.dataset.duration||'PT120M')?.[1]||120);
          const start=btn.dataset.start || $('#app').getAttribute('data-event-datetime');
          downloadICS({title, description:'Te esperamos ❤', location:place, start, durationMinutes:mins});
        });
      });
    })();
  </script>
</body>
</html>

